<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Carrito</title>
  <link rel="stylesheet" href="./css/index.css"> 
</head>
<body>
  <h1>Carrito de Compras</h1> 
  <button class="btn-volver" onclick="window.location.href='./index.html'">Volver a la tienda</button>
  
  <div id="carrito-container"></div>

  <div class="resumen-carrito">
    <p>Total productos: <span id="total-productos">0</span></p>
    <p>Total a pagar: <span id="total-precio">0.00</span> €</p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const contenedor = document.getElementById('carrito-container');
      let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

      function agruparProductos(carrito) {
        const agrupado = {};
        carrito.forEach(producto => {
          const clave = producto.id || producto.nombre;
          if (agrupado[clave]) {
            agrupado[clave].cantidad += 1;
          } else {
            agrupado[clave] = { ...producto, cantidad: 1 };
          }
        });
        return Object.values(agrupado);
      }

      function renderCarrito() {
        contenedor.innerHTML = '';

        if (carrito.length === 0) {
          contenedor.innerHTML = '<p>Tu carrito está vacío.</p>';
          return;
        }

        const productosAgrupados = agruparProductos(carrito);

        productosAgrupados.forEach((producto) => {
          const item = document.createElement('div');
          item.className = 'producto-carrito';
          item.innerHTML = `
            <img src="${producto.imagen}" alt="${producto.nombre}" class="producto-imagen">
            <h3 class="producto-nombre">${producto.nombre}</h3>
            <p class="producto-detalle">Marca: ${producto.marca}</p>
            <p class="producto-detalle">Sexo: ${producto.sexo}</p>
            <p class="producto-detalle">Cantidad: ${producto.cantidad}</p>
            <p class="producto-precio">Precio: ${producto.precio}€</p>
            <p class="producto-precio">Subtotal: ${(producto.precio * producto.cantidad).toFixed(2)}€</p>
            <button class="eliminar-btn" data-nombre="${producto.nombre}">Eliminar uno</button>
            <hr>
          `;
          contenedor.appendChild(item);
        });

        // Calcular totales
        let totalProductos = carrito.length;
        let totalPrecio = carrito.reduce((sum, producto) => sum + parseFloat(producto.precio), 0);

        document.getElementById('total-productos').textContent = totalProductos;
        document.getElementById('total-precio').textContent = totalPrecio.toFixed(2);

        // Listeners para eliminar uno
        document.querySelectorAll('.eliminar-btn').forEach(btn => {
          btn.addEventListener('click', e => {
            const nombre = e.target.dataset.nombre;
            eliminarUnProducto(nombre);
          });
        });
      }

      function eliminarUnProducto(nombre) {
        const index = carrito.findIndex(p => p.nombre === nombre);
        if (index !== -1) {
          carrito.splice(index, 1);
          localStorage.setItem('carrito', JSON.stringify(carrito));
          renderCarrito();
        }
      }

      renderCarrito();
    });
  </script>
</body>
</html>